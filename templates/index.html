<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AODA Compliance Checker</title>

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css" rel="stylesheet">

    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);

            /* WCAG AA Compliant Color Overrides */
            --bs-warning: #996600;  /* Darker yellow: 4.6:1 contrast on white */
            --bs-warning-rgb: 153, 102, 0;
            --bs-info: #0a7ea4;     /* Darker cyan: 4.5:1 contrast on white */
            --bs-info-rgb: 10, 126, 164;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem 0;
        }

        .main-card {
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
        }

        /* Override Bootstrap colors for WCAG AA compliance */
        .text-warning {
            color: #996600 !important;  /* 4.6:1 contrast ratio */
        }

        .bg-warning {
            background-color: #996600 !important;
            color: white !important;
        }

        .badge.bg-warning {
            background-color: #996600 !important;
            color: white !important;
        }

        .text-info {
            color: #0a7ea4 !important;  /* 4.5:1 contrast ratio */
        }

        .bg-info {
            background-color: #0a7ea4 !important;
            color: white !important;
        }

        .gradient-btn {
            background: var(--primary-gradient);
            border: none;
            transition: transform 0.2s, box-shadow 0.2s;
            color: #ffffff;
        }

        .gradient-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
            background: var(--primary-gradient);
            color: #ffffff;
        }

        .gradient-btn:active {
            transform: translateY(0);
        }

        .gradient-btn:focus {
            outline: 3px solid #ffc107;
            outline-offset: 2px;
        }

        .stat-card {
            border-left: 4px solid #667eea;
            transition: transform 0.2s;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .feature-item::before {
            content: "\f26b";
            font-family: "bootstrap-icons";
            color: #198754;
            font-weight: bold;
            margin-right: 0.5rem;
        }

        /* Accessibility: Skip to content link */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: #000;
            color: #fff;
            padding: 8px;
            text-decoration: none;
            z-index: 100;
        }

        .skip-link:focus {
            top: 0;
        }

        /* Improved focus visibility */
        a:focus, button:focus, input:focus, select:focus, textarea:focus {
            outline: 3px solid #ffc107;
            outline-offset: 2px;
        }
    </style>
</head>
<body>
    <!-- Skip to main content link for keyboard users -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <div class="container py-4">
        <div class="card main-card bg-white">
            <div class="card-body p-4 p-md-5">
                <!-- Header -->
                <header class="text-center mb-4">
                    <nav aria-label="Secondary navigation" class="d-flex justify-content-end mb-2">
                        <a href="/history" class="btn btn-outline-primary btn-sm" aria-label="View scan history">
                            <i class="bi bi-clock-history" aria-hidden="true"></i> View History
                        </a>
                    </nav>
                    <h1 class="display-4 fw-bold text-dark mb-2">
                        <i class="bi bi-search" aria-hidden="true"></i> AODA Compliance Checker
                    </h1>
                    <p class="lead text-muted">
                        Scan your website for WCAG 2.1 AA accessibility compliance
                    </p>
                </header>

                <!-- Scan Form -->
                <main id="main-content">
                <form id="scanForm" aria-label="Website accessibility scan form">
                    <div class="mb-4">
                        <label for="url" class="form-label fw-semibold">
                            <i class="bi bi-link-45deg" aria-hidden="true"></i> Website URL
                            <span class="text-danger" aria-label="required">*</span>
                        </label>
                        <input
                            type="url"
                            class="form-control form-control-lg"
                            id="url"
                            name="url"
                            placeholder="https://example.com"
                            required
                            aria-required="true"
                            aria-describedby="urlHelp"
                        >
                        <div id="urlHelp" class="form-text">
                            Enter the full URL of the website you want to scan
                        </div>
                    </div>

                    <fieldset class="row g-3 mb-4">
                        <legend class="h6 fw-semibold">Scan Configuration</legend>
                        <div class="col-md-6">
                            <label for="maxPages" class="form-label fw-semibold">
                                <i class="bi bi-files" aria-hidden="true"></i> Max Pages
                            </label>
                            <input
                                type="number"
                                class="form-control"
                                id="maxPages"
                                name="max_pages"
                                value="50"
                                min="1"
                                max="500"
                                aria-describedby="maxPagesHelp"
                            >
                            <div id="maxPagesHelp" class="form-text">Maximum pages to scan (1-500)</div>
                        </div>

                        <div class="col-md-6">
                            <label for="maxDepth" class="form-label fw-semibold">
                                <i class="bi bi-diagram-3" aria-hidden="true"></i> Max Depth
                            </label>
                            <input
                                type="number"
                                class="form-control"
                                id="maxDepth"
                                name="max_depth"
                                value="3"
                                min="1"
                                max="10"
                                aria-describedby="maxDepthHelp"
                            >
                            <div id="maxDepthHelp" class="form-text">How deep to crawl (1-10)</div>
                        </div>
                    </fieldset>

                    <fieldset class="mb-4">
                        <legend class="h6 fw-semibold">Crawling Options</legend>
                        <div class="form-check mb-2">
                            <input
                                class="form-check-input"
                                type="checkbox"
                                id="sameDomainOnly"
                                name="same_domain_only"
                                checked
                            >
                            <label class="form-check-label" for="sameDomainOnly">
                                Only scan pages from the same domain
                            </label>
                        </div>
                        <div class="form-check">
                            <input
                                class="form-check-input"
                                type="checkbox"
                                id="restrictToPath"
                                name="restrict_to_path"
                                checked
                                aria-describedby="restrictPathHelp"
                            >
                            <label class="form-check-label" for="restrictToPath">
                                Only scan pages within the starting URL's path
                            </label>
                            <div id="restrictPathHelp" class="form-text">
                                Example: Starting at https://example.com/services will only scan URLs under /services
                            </div>
                        </div>
                    </fieldset>

                    <fieldset class="mb-4">
                        <legend class="h6 fw-semibold">Advanced Options</legend>
                        <div class="form-check">
                            <input
                                class="form-check-input"
                                type="checkbox"
                                id="enableScreenshots"
                                name="enable_screenshots"
                                aria-describedby="screenshotsHelp"
                            >
                            <label class="form-check-label" for="enableScreenshots">
                                <i class="bi bi-camera" aria-hidden="true"></i> Capture screenshots of violations
                            </label>
                            <div id="screenshotsHelp" class="form-text">
                                <i class="bi bi-exclamation-triangle text-warning" aria-hidden="true"></i>
                                <strong>Performance Warning:</strong> Enabling screenshots will significantly slow down the scan.
                                A typical 3-page scan may take <strong>5-8 minutes</strong> instead of 30-60 seconds.
                                Only enable if you need visual evidence of violations.
                            </div>
                        </div>
                    </fieldset>

                    <button type="submit" class="btn btn-primary btn-lg w-100 gradient-btn" id="submitBtn" aria-describedby="submitBtnHelp">
                        <i class="bi bi-play-circle" aria-hidden="true"></i> Start Accessibility Scan
                    </button>
                </form>

                <!-- Status Display with ARIA live region -->
                <div id="status" class="mt-4" style="display: none;" role="status" aria-live="polite" aria-atomic="true"></div>

                <!-- Features List -->
                <aside aria-labelledby="features-heading">
                <div class="card bg-light mt-4">
                    <div class="card-body">
                        <h2 id="features-heading" class="card-title h5 fw-bold mb-3">
                            <i class="bi bi-check2-circle" aria-hidden="true"></i> What We Check
                        </h2>
                        <ul class="list-unstyled mb-0">
                            <li class="feature-item py-1">WCAG 2.1 Level AA compliance</li>
                            <li class="feature-item py-1">Color contrast ratios</li>
                            <li class="feature-item py-1">Keyboard navigation</li>
                            <li class="feature-item py-1">Screen reader compatibility</li>
                            <li class="feature-item py-1">Image alt text</li>
                            <li class="feature-item py-1">Form labels and ARIA attributes</li>
                            <li class="feature-item py-1">Heading structure and landmarks</li>
                            <li class="feature-item py-1">And 90+ other accessibility rules</li>
                        </ul>
                    </div>
                </div>
                </aside>
                </main>
            </div>
        </div>
    </div>

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


    <script>
        const form = document.getElementById('scanForm');
        const statusDiv = document.getElementById('status');
        const submitBtn = document.getElementById('submitBtn');

        let scanId = null;
        let pollInterval = null;

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            const formData = {
                url: document.getElementById('url').value,
                max_pages: parseInt(document.getElementById('maxPages').value),
                max_depth: parseInt(document.getElementById('maxDepth').value),
                same_domain_only: document.getElementById('sameDomainOnly').checked,
                restrict_to_path: document.getElementById('restrictToPath').checked,
                enable_screenshots: document.getElementById('enableScreenshots').checked
            };

            try {
                submitBtn.disabled = true;
                submitBtn.innerHTML = '<i class="bi bi-hourglass-split"></i> Starting scan...';
                showStatus('Starting accessibility scan...', 'info');

                const response = await fetch('/api/scan', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });

                const data = await response.json();
                scanId = data.scan_id;

                // Start polling for status
                pollInterval = setInterval(checkStatus, 2000);

            } catch (error) {
                showStatus('Error starting scan: ' + error.message, 'danger');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="bi bi-play-circle"></i> Start Accessibility Scan';
            }
        });

        async function checkStatus() {
            if (!scanId) return;

            try {
                const response = await fetch(`/api/scan/${scanId}`);
                const data = await response.json();

                if (data.status === 'completed') {
                    clearInterval(pollInterval);
                    showSuccess(data);
                } else if (data.status === 'failed') {
                    clearInterval(pollInterval);
                    const errorMsg = data.error_message || 'Unknown error occurred';
                    showStatus(`<strong>Scan failed:</strong> ${errorMsg}`, 'danger');
                    submitBtn.disabled = false;
                    submitBtn.innerHTML = '<i class="bi bi-play-circle"></i> Start Accessibility Scan';
                } else {
                    showProgress(data);
                }
            } catch (error) {
                clearInterval(pollInterval);
                showStatus('Error checking status: ' + error.message, 'danger');
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="bi bi-play-circle"></i> Start Accessibility Scan';
            }
        }

        function showStatus(message, type) {
            statusDiv.className = `alert alert-${type} border-start border-4`;
            statusDiv.style.display = 'block';
            statusDiv.innerHTML = message;
        }

        function showProgress(data) {
            const message = `
                <div class="d-flex align-items-center mb-3">
                    <div class="spinner-border text-primary me-3" role="status">
                        <span class="visually-hidden">Scanning in progress</span>
                    </div>
                    <strong>Scanning in progress...</strong>
                </div>
                <div class="row g-3">
                    <div class="col-6">
                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="text-muted small">Pages Scanned</div>
                                <div class="fs-2 fw-bold text-dark" aria-label="${data.pages_scanned} pages scanned">${data.pages_scanned}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="text-muted small">Violations Found</div>
                                <div class="fs-2 fw-bold text-dark" aria-label="${data.total_violations} violations found">${data.total_violations}</div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            showStatus(message, 'info');
        }

        function showSuccess(data) {
            const critical = data.violations_by_impact.critical;
            const serious = data.violations_by_impact.serious;
            const moderate = data.violations_by_impact.moderate;
            const minor = data.violations_by_impact.minor;

            const message = `
                <div class="d-flex align-items-center mb-3">
                    <i class="bi bi-check-circle-fill text-success fs-3 me-2" aria-hidden="true"></i>
                    <strong class="fs-5">Scan completed!</strong>
                </div>
                <div class="row g-3 mb-3">
                    <div class="col-6 col-md-3">
                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="text-muted small">Pages Scanned</div>
                                <div class="fs-4 fw-bold text-dark" aria-label="${data.pages_scanned} pages scanned">${data.pages_scanned}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="card stat-card">
                            <div class="card-body">
                                <div class="text-muted small">Total Violations</div>
                                <div class="fs-4 fw-bold text-dark" aria-label="${data.total_violations} total violations">${data.total_violations}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="card stat-card border-danger">
                            <div class="card-body">
                                <div class="text-muted small">Critical</div>
                                <div class="fs-4 fw-bold text-danger" aria-label="${critical} critical violations">${critical}</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-6 col-md-3">
                        <div class="card stat-card border-warning">
                            <div class="card-body">
                                <div class="small text-muted">Serious</div>
                                <div class="fs-4 fw-bold text-warning" aria-label="${serious} serious violations">${serious}</div>
                            </div>
                        </div>
                    </div>
                </div>
                <a href="/results/${scanId}" class="btn btn-lg btn-primary w-100 gradient-btn" aria-label="View detailed scan results">
                    <i class="bi bi-bar-chart-fill" aria-hidden="true"></i> View Detailed Results
                </a>
            `;
            showStatus(message, 'success');
            submitBtn.disabled = false;
            submitBtn.innerHTML = '<i class="bi bi-play-circle" aria-hidden="true"></i> Start Accessibility Scan';
        }
    </script>
</body>
</html>

